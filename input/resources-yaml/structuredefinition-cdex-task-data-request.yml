resourceType: StructureDefinition
id: cdex-task-data-request
url: 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/cdex-task-data-request'
version: 0.2.0
name: CDexTaskDataRequest
title: CDex Task Data Request Profile
status: active
description: |-
  This Task profile is based upon the [Da Vinci Hrex Task Data Request](http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request). It adds the following *must support* constraints for CDex:

  - A Task.identifier element representing the unique data request identifier
  - A Task.for.reference.identifier element representing a patient business identifier like a Member ID
  - A Task.requester.reference.identifier element representing the Payer business identifier
  - A Task.owner.reference.identifier element representing the Provider business identifier
  - A Task.reasonReference.reference.identifier for the claim, pre-auth or coverage business identifier
  - A Task.Restriction.period element to communicate the due date for submitting the requested data
  - For the "code" Task.input element, an extensible LOINCÂ® Document types value set to communicate the specific information being requested

  - A Task.input element representing a flag to indicate whether the requested data requires a signature
  - Extensions on the Task.input element "code" and "query" slices representing line item numbers in the Claim or Prior Authorization

  In addition, the following *optional* constraint:

  - A meta.tag element representing work-queue hints.
  - A Task.input element representing the purpose of use for the requested data using an extensible [CDex Purpose of Use Value Set](http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-POU)

fhirVersion: 4.0.1
kind: resource
abstract: false
type: Task
baseDefinition: 'http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request'
derivation: constraint
differential:
  element:
    - id: Task.meta
      path: Task.meta

    - id: 'Task.meta.tag'
      path: 'Task.meta.tag'
      slicing:
        discriminator:
          - type: pattern
            path: $this
        rules: open

    - id: 'Task.meta.tag.system'
      path: 'Task.meta.tag.system'

    - id: 'Task.meta.tag.code'
      path: 'Task.meta.tag.code'
      min: 1

    - id: 'Task.meta.tag:work-queue'
      path: Task.meta.tag
      sliceName: work-queue
      short: Work Queue Tag
      definition: Payer provided work queue tags that provider may use in their workflow to process request.
      binding:
        strength: required
        valueSet: 'http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-work-queue'

    # - id: Task.contained
    #   path: Task.contained
    #   slicing:
    #     discriminator:
    #       - type: type
    #         path: $this
    #     rules: open

    # - id: Task.contained:claim
    #   path: Task.contained
    #   sliceName: claim
    #   definition: >-
    #     The contained claim profile represents a claim or prior-authorization and is used to communicate a reason for a clinical data request.
    #   short: Contained Claim resource
    #   # min: 1
    #   max: '1'
    #   type:
    #     - code: Claim
    #       profile:
    #         - 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/cdex-claim'
    #   mustSupport: true

    # - id: Task.contained:patient
    #   path: Task.contained
    #   sliceName: patient
    #   definition: >-
    #     The contained patient profile representing is used to communicate additional patient demographic data.
    #   short: Contained Patient resource
    #   # min: 1
    #   max: '1'
    #   type:
    #     - code: Patient
    #       profile:
    #         - 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/cdex-patient-demographics'
    #   mustSupport: true

    - id: Task.identifier
      path: Task.identifier
      # slicing:
      #   discriminator:
      #     - type: pattern
      #       path: $this
      #   rules: open
      mustSupport: true

    # - id: Task.identifier.value
    #   path: Task.identifier.value
    #   min: 1
    #   max: '1'
    #   mustSupport: true

    # - id: 'Task.identifier:tracking-id'
    #   path: Task.identifier
    #   sliceName: tracking-id
    #   short: tracking identifier
    #   definition: A unique requester assigned identifier to track the request
    #   # min: 1
    #   max: '1'
    #   patternIdentifier:
    #     type:         
    #       coding:
    #         - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
    #           code: tracking-id
    #   mustSupport: true

    - id: Task.for
      path: Task.for
      mustSupport: true
  
    # - id: Task.for.reference
    #   path: Task.for.reference
    #   # short: Contained Patient
    #   # definition: Reference to contained Patient representing patient data elements are used to verify patient identity for compliance regulations (such as HIPAA).
    #   comment: For requesting attachments, a reference to a contained Patient Resource defined by the CDex Patient Demographics Profile is used to representing the patient demographic data elements used to verify patient identity for compliance regulations (such as HIPAA).
    #   # # min: 1
    #   # fixedString: '#patient'
    #   mustSupport: true    
    #   # add invariant  

    - id: Task.for.identifier
      path: Task.for.identifier
      short: Patient Member ID
      definition: business identifier representing the Patient
      # min: 0
      mustSupport: true    

    - id: Task.requester
      path: Task.requester
      mustSupport: true

    - id: Task.requester.identifier
      path: Task.requester.identifier
      short: Payer ID
      definition: business identifier representing the Payer
      # min: 0
      mustSupport: true


    - id: Task.owner
      path: Task.owner
      mustSupport: true

    - id: Task.owner.identifier
      path: Task.owner.identifier
      short: Provider ID
      definition: business identifier representing the Provider
      # min: 
      mustSupport: true

    - id: Task.reasonReference
      path: Task.reasonReference
      mustSupport: true

    # - id: Task.reasonReference.reference
    #   path: Task.reasonReference.reference
    #   # short: Contained Claim
    #   # definition: Reference to contained Claim representing claim or pre-authorization for required data.
    #   comment: A reference to a contained CDex Claim Profile is defined to be contained within the CDex Task Attachment Request Profile or CDex Task Data Request Profile. It is referenced when a reason for a clinical data request is communicated and the reason is a claim or prior-authorization (for example, an attachment request or a claims audit).
    #   # # min: 1
    #   # fixedString: '#claim'
    #   mustSupport: true    
    #   # add invariant 

    - id: Task.reasonReference.identifier
      path: Task.reasonReference.identifier
      short: Claim ID
      definition: business identifier representing the claim or prior-authorization ID
      # min: 
      mustSupport: true

    - id: Task.restriction
      path: Task.restriction
      mustSupport: true

    - id: Task.restriction.period
      path: Task.restriction.period
      short: Sumbission due date
      definition:  The due date for submitting the requested data
      comment: Note that `Task.restriction.period.end` is the due date representing the time by which the task should be completed.
      # min: 1
      mustSupport: true

    - id: Task.input
      path: Task.input
      slicing:
        discriminator:
          - type: pattern
            path: type
        rules: open
      # min: 1
      mustSupport: true


    - id: 'Task.input:query'
      path: Task.input
      sliceName: query
      mustSupport: true
   
    - id: 'Task.input:query.extension:item-ids'
      path: Task.input.extension
      sliceName: item-ids
      short: Line item numbers
      definition: The line item numbers in the Claim or Prior Authorization
      # min: 0
      max: '*'
      type:
        - code: Extension
          profile:
            - 'http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-serviceLineNumber'
      mustSupport: true

    - id: 'Task.input:code'
      path: Task.input
      sliceName: code
      mustSupport: true

    - id: 'Task.input:code.extension:item-ids'
      path: Task.input.extension
      sliceName: item-ids
      short: Line item numbers
      definition: The line item numbers in the Claim or Prior Authorization the request applies to.
      # min: 0
      max: '*'
      type:
        - code: Extension
          profile:
            - 'http://hl7.org/fhir/us/davinci-pas/StructureDefinition/extension-serviceLineNumber'
      mustSupport: true
  

    - id: 'Task.input:code.valueCodeableConcept'
      path: Task.input.valueCodeableConcept
      min: 1
      max: '1'
      binding:
        strength: extensible
        valueSet: 'http://hl7.org/fhir/us/core/ValueSet/us-core-documentreference-type'

    - id: 'Task.input:signature'
      path: Task.input
      sliceName: signature
      short: Signature flag
      definition: Flag to indicate whether the requested data requires a signature.
      max: '1'
      mustSupport: true

    - id: 'Task.input:signature.type'
      path: Task.input.type
      patternCodeableConcept:
        coding:
          - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
            code: signature-flag
      mustSupport: true

    - id: 'Task.input:signature.value[x]'
      path: 'Task.input.value[x]'
      short: Signature flag value
      type:
        - code: boolean
      mustSupport: true

    - id: 'Task.input:POU'
      path: Task.input
      sliceName: POU
      short: Purpose of use code
      definition: Represent the purpose of use for the requested data.
      max: '1'
      # mustSupport: true

    - id: 'Task.input:POU.type'
      path: Task.input.type
      patternCodeableConcept:
        coding:
          - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
            code: purpose-of-use
      # mustSupport: true

    - id: 'Task.input:POU.value[x]'
      path: 'Task.input.value[x]'
      short: Purpose of use value
      type:
        - code: CodeableConcept
      binding:
        strength: extensible
        valueSet: 'http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-POU'
      mustSupport: true


    # - id: 'Task.input:payer-url'
    #   path: Task.input
    #   sliceName: payer-url
    #   short: Payer Url
    #   definition: The Payer Endpoint URL for submitting attachment using the $submit-attachment operation.
    #   # min: 0
    #   max: '1'
    #   mustSupport: true

    # - id: 'Task.input:payer-url.type'
    #   path: Task.input.type
    #   patternCodeableConcept:
    #     coding:
    #       - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
    #         code: payer-url
    #   mustSupport: true

    # - id: 'Task.input:payer-url.value[x]'
    #   path: 'Task.input.value[x]'
    #   short: Payer url value
    #   type:
    #     - code: url
    #   mustSupport: true

    # - id: 'Task.input:multiple-submits'
    #   path: Task.input
    #   sliceName: multiple-submits
    #   short: Multiple submits flag
    #   definition: |-
    #     Flag to indicate whether the requested data can be submitted in multiple submissions. The default meaning when this input is omitted is multiple-submits = "false" -  all the requested data should be submitted in a single transaction.
    #   max: '1'

    # - id: 'Task.input:multiple-submits.type'
    #   path: Task.input.type
    #   patternCodeableConcept:
    #     coding:
    #       - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
    #         code: multiple-submits-flag

    # - id: 'Task.input:multiple-submits.value[x]'
    #   path: 'Task.input.value[x]'
    #   short: Multiple submits flag value
    #   type:
    #     - code: boolean


