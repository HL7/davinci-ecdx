resourceType: StructureDefinition
id: cdex-task-data-request
url: 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/cdex-task-data-request'
version: 0.2.0
name: CDexTaskDataRequest
title: CDex Task Data Request Profile
status: active
description: |-
  This Task profile is based upon the [Da Vinci Hrex Task Data Request](http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request). It adds the following additional constraints for CDEX:
  - A Task.identifier element representing the payers tracking identifier (referred to as the “re-association tracking control numbers”)
  - A meta.tag element representing work-queue hints.
  - A Task.requester.reference.identifier element representing the Payer ID
  - A Task.for.reference.identifier element representing the Patient MemberId
  - A Task.input element slice representing the types of documents to be returned using the extensible LOINC® Document types value set.
  - A Task.input element slice representing a flag to indicate whether the requested data requires a signature.
  - A Task.input element slice representing the purpose of use for the requested data using an extensible *CDex Purpose of Use Value Set*.
  - A Task.input element slice representing the Payer Endpoint URL for submitting attachment using the $submit-attachment operation.
  - An extension on the Task.input element "code" and "query" slices representing line item numbers in the Claim or Prior Authorization.
  - A Task.reasonReference slice to a contained Claim Resource representing claim or pre-authorization:
      - type
      - id
      - date of service
      - patient member id
      - patient account no
  - A Task.Restriction.period representing the due date for the attachments.

fhirVersion: 4.0.1
kind: resource
abstract: false
type: Task
baseDefinition: 'http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request'
derivation: constraint
differential:
  element:
    - id: Task.meta
      path: Task.meta

    - id: 'Task.meta.tag'
      path: 'Task.meta.tag'
      slicing:
        discriminator:
          - type: pattern
            path: $this
        rules: open

    - id: 'Task.meta.tag.system'
      path: 'Task.meta.tag.system'

    - id: 'Task.meta.tag.code'
      path: 'Task.meta.tag.code'
      min: 1

    - id: 'Task.meta.tag:work-queue'
      path: Task.meta.tag
      sliceName: work-queue
      short: Work Queue Tag
      definition: Payer provided work queue tags that provider may use in their workflow to process request.
      binding:
        strength: required
        valueSet: 'http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-work-queue'


    - id: Task.contained # TODO make this a slice or add an invara
      path: Task.contained
      definition: >-
        The contained claim profile representing the required claim or pre-authorization data needed for attachments requests
      short: Contained Claim resource
      # min: 1
      max: '1'
      type:
        - code: Claim
          profile:
            - 'http://hl7.org/fhir/us/davinci-pas/StructureDefinition/profile-claim'
      mustSupport: true


    - id: Task.identifier
      path: Task.identifier

      slicing:
        discriminator:
          - type: pattern
            path: $this
        rules: open
      mustSupport: true

    - id: Task.identifier.value
      path: Task.identifier.value
      min: 1
      max: '1'
      mustSupport: true

    - id: 'Task.identifier:tracking-id'
      path: Task.identifier
      sliceName: tracking-id
      short: Re-association tracking control number
      definition: A unique claim/prior authorization identifier (referred to as the “re-association tracking control numbers”)
      # min: 1
      max: '1'
      patternIdentifier:
        type:         
          coding:
            - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
              code: tracking-id
      mustSupport: true

    - id: Task.for
      path: Task.for

    - id: Task.for.identifier
      path: Task.for.identifier
      short: Patient Member ID
      definition: business identifier representing the Patient Member ID
      # min: 1
      mustSupport: true    

    - id: Task.requester
      path: Task.requester

    - id: Task.requester.identifier
      path: Task.requester.identifier
      short: Payer ID
      definition: business identifier representing the Payer ID
      # min: 1
      mustSupport: true

    - id: Task.restriction
      path: Task.restriction
      mustSupport: true

    - id: Task.restriction.period
      path: Task.restriction.period
      short: Attachments due date
      definition: due date for the attachments
      # min: 1
      mustSupport: true

    - id: Task.reasonReference
      path: Task.reasonReference

    - id: Task.reasonReference.reference
      path: Task.reasonReference.reference
      short: Contained Claim
      definition: Reference to contained Claim representing claim or pre-authorization for required data.
      # min: 1
      fixedString: '#claim'
      mustSupport: true    
      # add invariant     

    - id: 'Task.input:query'
      path: Task.input
      sliceName: query
   
    - id: 'Task.input:query.extension:item-ids'
      path: Task.input.extension
      sliceName: item-ids
      short: Line item numbers
      definition: The line item numbers in the Claim or Prior Authorization
      # min: 0
      max: '1'
      type:
        - code: Extension
          profile:
            - 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/item-ids'
      mustSupport: true



    - id: 'Task.input:code'
      path: Task.input
      sliceName: code


    - id: 'Task.input:code.extension:item-ids'
      path: Task.input.extension
      sliceName: item-ids
      short: Line item numbers
      definition: The line item numbers in the Claim or Prior Authorization the request applies to.
      # min: 0
      max: '1'
      type:
        - code: Extension
          profile:
            - 'http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/item-ids'
      mustSupport: true
  

    - id: 'Task.input:code.valueCodeableConcept'
      path: Task.input.valueCodeableConcept
      min: 1
      max: '1'
      binding:
        strength: extensible
        valueSet: 'http://hl7.org/fhir/us/core/ValueSet/us-core-documentreference-type'

    - id: 'Task.input:signature'
      path: Task.input
      sliceName: signature
      short: Signature flag
      definition: Flag to indicate whether the requested data requires a signature.
      max: '1'
      mustSupport: true

    - id: 'Task.input:signature.type'
      path: Task.input.type
      patternCodeableConcept:
        coding:
          - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
            code: signature-flag
      mustSupport: true

    - id: 'Task.input:signature.value[x]'
      path: 'Task.input.value[x]'
      short: Signature flag value
      type:
        - code: boolean
      mustSupport: true

    - id: 'Task.input:POU'
      path: Task.input
      sliceName: POU
      short: Purpose of use code
      definition: Represent the purpose of use for the requested data.
      max: '1'
      mustSupport: true

    - id: 'Task.input:POU.type'
      path: Task.input.type
      patternCodeableConcept:
        coding:
          - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
            code: purpose-of-use
      mustSupport: true

    - id: 'Task.input:POU.value[x]'
      path: 'Task.input.value[x]'
      short: Purpose of use value
      type:
        - code: CodeableConcept
      binding:
        strength: extensible
        valueSet: 'http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-POU'
      mustSupport: true


    - id: 'Task.input:payer-url'
      path: Task.input
      sliceName: payer-url
      short: Payer Url
      definition: The Payer Endpoint URL for submitting attachment using the $submit-attachment operation.
      # min: 0
      max: '1'
      mustSupport: true

    - id: 'Task.input:payer-url.type'
      path: Task.input.type
      patternCodeableConcept:
        coding:
          - system: 'http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp'
            code: payer-url
      mustSupport: true

    - id: 'Task.input:payer-url.value[x]'
      path: 'Task.input.value[x]'
      short: Payer url value
      type:
        - code: url
      mustSupport: true

