title Steps for DTR SMART App Launch

participant DTR App
participant Provider DTR Client
actor Provider User
participant Provider FHIR Server
entryspacing 1.2
note over Provider DTR Client: HIT with Authorization Server

autonumber
opt Precondition: Client Registration
entryspacing 0.5
DTR App->Provider DTR Client: (may be out of band)
end 

group EHR Launch

note over Provider DTR Client,Provider User: Receives CDex request\nfor attachments (Task) with\nQuestionnaire input
Provider User->Provider DTR Client: Provider User\nlaunches App
Provider DTR Client->DTR App: Launch request
end
 
 
DTR App->Provider FHIR Server:Discovery request
autonumber off
Provider FHIR Server-->DTR App: Discovery response
autonumber 
DTR App->Provider DTR Client: Authorization request*
note over DTR App: *Required scopes: "launch", "launch/patient",\n"**launch/task**", "patient/*.rs", "**patient/Task.u",\n"patient/QuestionnaireResponse.cu**"
#opt
#Provider User->Provider DTR Client: User input #incorporated\ninto authorization decision
#end

alt DTR Granted Access
Provider DTR Client-->DTR App:Authorization granted
DTR App->Provider FHIR Server:Access token request
Provider DTR Client-->DTR App: Access token response\*\*
note over Provider DTR Client: \*\*launch context in "fhirContext" array\nincludes local reference to the Task
ref over DTR App, Provider FHIR Server: 9 Request Resources (see section 5.4.1 above)

else DTR Denied Access
autonumber 10

Provider DTR Client-->DTR App:Authorization error
end