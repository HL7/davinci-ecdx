{
    "resourceType": "StructureDefinition",
    "id": "cdex-task-data-request",
    "url": "http://hl7.org/fhir/us/davinci-cdex/StructureDefinition/cdex-task-data-request",
    "version": "0.2.0",
    "name": "CDexTaskDataRequest",
    "title": "CDex Task Data Request Profile",
    "status": "active",
    "description": "This Task profile is based upon the [Da Vinci HRex Task Data Request](http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request). It adds the following *must support* constraints for CDex:\n\n- A Task.identifier element representing the unique data request identifier\n- A Task.for.reference.identifier element representing a patient business identifier like a Member ID\n- A Task.requester.reference.identifier element representing the Payer business identifier\n- A Task.owner.reference.identifier element representing the Provider business identifier\n- A Task.reasonReference.reference.identifier for the claim, pre-auth or coverage business identifier\n- For the \"code\" Task.input element, an extensible LOINC\u00ae Document types value set to communicate the specific information being requested\n- A Task.input element representing a flag to indicate whether the requested data requires a signature\n\nIn addition, the following *optional* constraint:\n- A Task.code.coding of 'data-request-questionnaire\" communicating to the data source that a data request questionnaire is being submitted.\n   - If the code is \"attachment-request-questionnaire\", the provider system uses [Documentation Templates and Rules (DTR)](http://hl7.org/fhir/us/davinci-dtr/2022May/) to complete the questionnaire referenced in the \"questionnaire-url\" input parameter.\n- A meta.tag element representing work-queue hints.\n- A \"questionnaire-url\" Task.input element to communicate to the provider a URL of a data request questionnaire ([FHIR Questionnaire](http://hl7.org/fhir/questionnaire.html)).\n- A Task.input element representing the purpose of use for the requested data using an extensible [CDex Purpose of Use Value Set](http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-POU)",
    "fhirVersion": "4.0.1",
    "kind": "resource",
    "abstract": false,
    "type": "Task",
    "baseDefinition": "http://hl7.org/fhir/us/davinci-hrex/StructureDefinition/hrex-task-data-request",
    "derivation": "constraint",
    "differential": {
        "element": [
            {
                "id": "Task",
                "path": "Task",
                "definition": "This Task profile is used by the CDex Data Consumer (e.g. Payer or other Provider) to solicit information from a Data Source (e.g., Provider) asynchronously where human involvement to find/aggregate/filter/approve requests may be required.",
                "constraint": [
                    {
                        "key": "cdex-7",
                        "severity": "error",
                        "human": "If no code = \"data-request-questionnaire\", must have \"code\" or \"query\" input.",
                        "expression": "Task.code.coding.code.where($this='attachment-request-code').empty() implies Task.input.type.coding.code.where($this='data-query' or $this='data-code').exists()"
                    },
                    {
                        "key": "cdex-8",
                        "severity": "error",
                        "human": "If code = \"data-request-questionnaire\", must have one \"questionnaire-url\" input.",
                        "expression": "Task.code.coding.code.where($this='attachment-request-questionnaire').exists() implies Task.input.type.coding.code.where($this='questionnaire-url').exists()"
                    },
                    {
                        "key": "cdex-9",
                        "severity": "error",
                        "human": "Must have exactly one input that is data-query or data-code or questionnaire_url (note this conflicts with HREX tdr-1).",
                        "expression": "Task.input.type.coding.code.where($this='data-query' or $this='data-code' or $this='questionnaire_url').count()=1"
                    }
                ]
            },
            {
                "id": "Task.meta",
                "path": "Task.meta"
            },
            {
                "id": "Task.meta.tag",
                "path": "Task.meta.tag",
                "slicing": {
                    "discriminator": [
                        {
                            "type": "pattern",
                            "path": "$this"
                        }
                    ],
                    "rules": "open"
                }
            },
            {
                "id": "Task.meta.tag.system",
                "path": "Task.meta.tag.system"
            },
            {
                "id": "Task.meta.tag.code",
                "path": "Task.meta.tag.code",
                "min": 1
            },
            {
                "id": "Task.meta.tag:work-queue",
                "path": "Task.meta.tag",
                "sliceName": "work-queue",
                "short": "Work Queue Tag",
                "definition": "Payer provided work queue tags that providers may use in their workflow to process requests.",
                "binding": {
                    "strength": "required",
                    "valueSet": "http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-work-queue"
                }
            },
            {
                "id": "Task.identifier",
                "path": "Task.identifier",
                "mustSupport": true
            },
            {
                "id": "Task.code",
                "path": "Task.code",
                "short": "Data Request",
                "definition": "The code element is used to indicate that Task is a request for data and must be populated with the value \"data-request\"."
            },
            {
                "id": "Task.code.coding",
                "path": "Task.code.coding",
                "slicing": {
                    "discriminator": [
                        {
                            "type": "pattern",
                            "path": "$this"
                        }
                    ],
                    "rules": "open"
                }
            },
            {
                "id": "Task.code.coding:questionnaire",
                "path": "Task.code.coding",
                "sliceName": "questionnaire",
                "short": "Data Request Questionnaire",
                "definition": "A Task.code.coding of 'data-request-questionnaire\" communicating to the data source that a data request questionnaire is being submitted.",
                "min": 0,
                "max": "1",
                "patternCoding": {
                    "system": "http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp",
                    "code": "data-request-questionnaire"
                }
            },
            {
                "id": "Task.for",
                "path": "Task.for",
                "mustSupport": true
            },
            {
                "id": "Task.for.identifier",
                "path": "Task.for.identifier",
                "short": "Patient Member ID",
                "definition": "business identifier representing the Patient",
                "mustSupport": true
            },
            {
                "id": "Task.requester",
                "path": "Task.requester",
                "mustSupport": true
            },
            {
                "id": "Task.requester.identifier",
                "path": "Task.requester.identifier",
                "short": "Payer ID",
                "definition": "business identifier representing the Payer",
                "mustSupport": true
            },
            {
                "id": "Task.owner",
                "path": "Task.owner",
                "mustSupport": true
            },
            {
                "id": "Task.owner.identifier",
                "path": "Task.owner.identifier",
                "short": "Provider ID",
                "definition": "business identifier representing the Provider",
                "mustSupport": true
            },
            {
                "id": "Task.reasonReference",
                "path": "Task.reasonReference",
                "mustSupport": true
            },
            {
                "id": "Task.reasonReference.identifier",
                "path": "Task.reasonReference.identifier",
                "short": "Coverage or Claim ID",
                "definition": "business identifier representing the coverage, claim, or prior-authorization ID",
                "comment": "Most payer systems will not expose their claim and prior authorization records as a FHIR resource. They will provide a unique business identifier for the claim or prior authorization using `Task.reasonReference.identifier`.  This could be a payer-assigned or provider-assigned identifier which **SHOULD** be communicated in `Task.reasonReference.identifier.type` using the \"FILL\" for the payer and \"PLAC\" for the provider.",
                "mustSupport": true
            },
            {
                "id": "Task.input",
                "path": "Task.input",
                "slicing": {
                    "discriminator": [
                        {
                            "type": "pattern",
                            "path": "type"
                        }
                    ],
                    "rules": "open"
                },
                "mustSupport": true
            },
            {
                "id": "Task.input:query",
                "path": "Task.input",
                "sliceName": "query",
                "mustSupport": true
            },
            {
                "id": "Task.input:code",
                "path": "Task.input",
                "sliceName": "code",
                "mustSupport": true
            },
            {
                "id": "Task.input:code.valueCodeableConcept",
                "path": "Task.input.valueCodeableConcept",
                "min": 1,
                "max": "1",
                "binding": {
                    "strength": "extensible",
                    "valueSet": "http://hl7.org/fhir/us/core/ValueSet/us-core-documentreference-type"
                }
            },
            {
                "id": "Task.input:questionnaire-url",
                "extension": [
                    {
                        "url": "http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status",
                        "valueCode": "draft"
                    }
                ],
                "path": "Task.input",
                "sliceName": "questionnaire-url",
                "short": "Data Request questionnaire",
                "definition": "The Questionnaire URL for a data request questionnaire.",
                "max": "1",
                "condition": [
                    "cdex-5",
                    "cdex-6"
                ]
            },
            {
                "id": "Task.input:questionnaire-url.type",
                "path": "Task.input.type",
                "patternCodeableConcept": {
                    "coding": [
                        {
                            "system": "http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp",
                            "code": "questionnaire-url"
                        }
                    ]
                }
            },
            {
                "id": "Task.input:questionnaire-url.value[x]",
                "path": "Task.input.value[x]",
                "short": "Questionnaire URL value",
                "type": [
                    {
                        "code": "url"
                    }
                ]
            },
            {
                "id": "Task.input:signature",
                "path": "Task.input",
                "sliceName": "signature",
                "short": "Signature flag",
                "definition": "Flag to indicate whether the requested data requires a signature.",
                "max": "1",
                "mustSupport": true
            },
            {
                "id": "Task.input:signature.type",
                "path": "Task.input.type",
                "patternCodeableConcept": {
                    "coding": [
                        {
                            "system": "http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp",
                            "code": "signature-flag"
                        }
                    ]
                },
                "mustSupport": true
            },
            {
                "id": "Task.input:signature.value[x]",
                "path": "Task.input.value[x]",
                "short": "Signature flag value",
                "type": [
                    {
                        "code": "boolean"
                    }
                ],
                "mustSupport": true
            },
            {
                "id": "Task.input:POU",
                "path": "Task.input",
                "sliceName": "POU",
                "short": "Purpose of use code",
                "definition": "Represent the purpose of use for the requested data.",
                "max": "1"
            },
            {
                "id": "Task.input:POU.type",
                "path": "Task.input.type",
                "patternCodeableConcept": {
                    "coding": [
                        {
                            "system": "http://hl7.org/fhir/us/davinci-cdex/CodeSystem/cdex-temp",
                            "code": "purpose-of-use"
                        }
                    ]
                }
            },
            {
                "id": "Task.input:POU.value[x]",
                "path": "Task.input.value[x]",
                "short": "Purpose of use value",
                "type": [
                    {
                        "code": "CodeableConcept"
                    }
                ],
                "binding": {
                    "strength": "extensible",
                    "valueSet": "http://hl7.org/fhir/us/davinci-cdex/ValueSet/cdex-POU"
                }
            }
        ]
    }
}